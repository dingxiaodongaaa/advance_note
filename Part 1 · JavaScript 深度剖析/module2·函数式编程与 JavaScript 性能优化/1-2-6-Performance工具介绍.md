### 为什么使用Performance

- GC 的目的是为了实现内存空间的良性循环
- 良性循环的即使是合理使用
- 时刻关注才能确定是否合理
- Performance 提供多种监控方式

通过Performance时刻监控内存的变化

#### Performance 使用步骤 

- 打开浏览器输入目标网址
- 进入开发人员工具面板，选择性能
- 开启录制功能，访问具体界面
- 执行用户行为，一段时间后停止录制
- 分析界面中记录的内存信息

### 内存问题的体现

- 页面出现延迟加载或经常性暂停
- 页面持续性出现糟糕的性能
- 页面的性能随时间延长越来越差

**分析：**

1. （频繁的垃圾回收）如果网络状态良好，这种状况可能就是由于频繁的垃圾回收引起的。可能是因为代码中有瞬间让内存被占满的操作，内存直接爆掉。这显然需要定位。

2. （内存膨胀）在底层出现了内存膨胀的问题。内存膨胀就是当前页面为了达到最佳的使用速度，他可能回去申请一定的内存空间，但是这个内存空间的大小远超过当前设备本身所能提供的内存大小，所以这个时候就会感觉到持续性卡顿。

3. （内存泄漏）随着时间的延长，页面出现越来越卡顿的情况，多是因为内存泄漏造成的，内存泄漏造成内存得不到释放，随着时间的延长内存的占用逐渐升高，而且一直得不到释放，就会造成卡顿的问题。

### 监控内存的几种方式

**界定内存问题的标准：**

- 内存泄漏：内存使用持续升高
- 内存膨胀：在多数设备上存在性能问题
- 频繁垃圾回收：通过内存变化图进行分析

**监控方式：**

- 浏览器任务管理器
- TimeLine时序图记录
- 堆快照查找分离 DOM（分离 DOM 会造成内存泄漏）
- 判断是否存在频繁的垃圾回收

#### 任务管理器监控内存

通过任务管理器可以查看JS内存的占用变化情况，判断内存问题，但是并不能定位问题。

#### TimeLine 记录内存

可以使用时间线，检查问题代码出在哪里。

#### 堆快照查找分离DOM

堆快照就是保存 JS 堆的照片

**什么是分离 DOM**

在界面上看到的很多元素其实都是 DOM 节点，这些 DOM 节点是存活的DOM树上的，节点分为几种形态，其中一种叫做垃圾对象，一种叫做分离 DOM。

垃圾对象，如果这个节点从当前的 DOM 树上脱离了，而且在JS脚本中也没有再引用这个 DOM 节点，那他就是一个垃圾。

分离 DOM ，如果这个 DOM 节点只是从当前的 DOM 树上脱离了，但是再 JS 脚本中还有再引用的地方，这种 DOM 就叫做分离 DOM 。

分离 DOM 再界面上看不见， 但是再内存中占据着空间。就会造成内存泄漏。

#### 判断是否存在频繁 GC

为什么要确定频繁的垃圾回收

- GC 工作时，程序是停止的
- 频繁且过长的 GC 会导致应用假死
- 用户使用中感知应用卡顿

确定的方法：

1. TimeLine中频繁的上升下降
2. 任务管理器中数据频繁的增加减小

### Performan总结

- performance使用流程
- 内存问题的相关分析
- Performance时序图监控内存变化
- 任务管理器监控内存变化
- 堆快照查找分离DOM

